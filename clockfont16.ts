/**
 * Font for 16*64 neopixel panel Display blocks
 */
//% weight=100 color=#0fbc11 icon="\u270f" block="font for clock"
namespace clockFont {
    let strip = neopixel.create(DigitalPin.P1, 1024, NeoPixelMode.RGB);
    let color: number = NeoPixelColors.White;

    const font9: number[][] = [
        [0x3FFC, 0x7FFE, 0xE007, 0xC003, 0xC003, 0xC003, 0xE007, 0x7FFE, 0x3FFC], // 0
        [0x0000, 0x0000, 0x0000, 0x6003, 0xFFFF, 0xFFFF, 0x0003, 0x0000, 0x0000], // 1
        [0x301F, 0x703F, 0xE073, 0xC0E3, 0xC0C3, 0xC0C3, 0xE1C3, 0x7F83, 0x3F03], // 2
        [0x300C, 0x700E, 0xE187, 0xC183, 0xC183, 0xC183, 0xE3C7, 0x7FFE, 0x3E7C], // 3
        [0x07F0, 0x0FF0, 0x1C30, 0x3830, 0x7030, 0xFFFF, 0xFFFF, 0x0030, 0x0030], // 4
        [0xFF0C, 0xFF0E, 0xC307, 0xC303, 0xC303, 0xC303, 0xC387, 0xC1FE, 0xC0FC], // 5
        [0x3FFC, 0x7FFE, 0xE187, 0xC183, 0xC183, 0xC183, 0xE1C7, 0x70FE, 0x307C], // 6
        [0xC000, 0xC000, 0xC0FF, 0xC1FF, 0xC380, 0xC700, 0xCE00, 0xFC00, 0xF800], // 7
        [0x3E7C, 0x7FFE, 0xE3C7, 0xC183, 0xC183, 0xC183, 0xE3C7, 0x7FFE, 0x3E7C], // 8
        [0x3E0C, 0x7F0E, 0xE387, 0xC183, 0xC183, 0xC183, 0xE387, 0x7FFE, 0x3FFC]  // 9
    ];
    const font8: number[][] = [
        [0x3FFC, 0x7FFE, 0xE007, 0xC003, 0xC003, 0xE007, 0x7FFE, 0x3FFC], // 0
        [0x0000, 0x0000, 0x6003, 0xFFFF, 0xFFFF, 0x0003, 0x0000, 0x0000], // 1
        [0x301F, 0x703F, 0xE073, 0xC0E3, 0xC0C3, 0xE1C3, 0x7F83, 0x3F03], // 2
        [0x300C, 0x700E, 0xE187, 0xC183, 0xC183, 0xE3C7, 0x7FFE, 0x3E7C], // 3
        [0x07F0, 0x0FF0, 0x1C30, 0x3830, 0x7030, 0xFFFF, 0xFFFF, 0x0030], // 4
        [0xFF0C, 0xFF0E, 0xC307, 0xC303, 0xC303, 0xC387, 0xC1FE, 0xC0FC], // 5
        [0x3FFC, 0x7FFE, 0xE187, 0xC183, 0xC183, 0xE1C7, 0x70FE, 0x307C], // 6
        [0xC000, 0xC000, 0xC1FF, 0xC3FF, 0xC700, 0xCE00, 0xFC00, 0xF800], // 7
        [0x3E7C, 0x7FFE, 0xE3C7, 0xC183, 0xC183, 0xE3C7, 0x7FFE, 0x3E7C], // 8
        [0x3E0C, 0x7F0E, 0xE383, 0xC183, 0xC183, 0xE387, 0x7FFE, 0x3FFC]  // 9
    ];
    const font10: number[][] = [
        [0x0FF0, 0x1FF8, 0x300C, 0x6006, 0x6006, 0x6006, 0x6006, 0x300C, 0x1FF8, 0x0FF0], // ○
        [0x700E, 0x781E, 0x0C30, 0x0660, 0x03C0, 0x03C0, 0x0660, 0x0C30, 0x781E, 0x700E]  // ×
    ];
    const font12: number[][] = [
        [0x03C0, 0x0FF0, 0x1C38, 0x300C, 0x6006, 0x6006, 0x6006, 0x6006, 0x300C, 0x1C38, 0x0FF0, 0x03C0], // ○
        [0x4002, 0x6006, 0x300C, 0x1818, 0x0C30, 0x07E0, 0x07E0, 0x0C30, 0x1818, 0x300C, 0x6006, 0x4002]  // ×
    ];
    const font64: number[][] = [
        [0xC000, 0xC000, 0xC000, 0xFFFF, 0xFFFF, 0xC000, 0xC000, 0xC000, 0x0000, 0xFFFF, 0xFFFF, 0x0180, 0x0300, 0x03FF, 0x01FF, 0x0000, 0x00FC, 0x01FE, 0x0333, 0x0333, 0x01F6, 0x00F4, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xC180, 0xC180, 0xC180, 0xE380, 0x7F00, 0x3E00, 0x0000, 0xFFFF, 0xFFFF, 0xC183, 0xC183, 0xC183, 0xC183, 0xC003, 0x0000, 0x001F, 0x03FF, 0x3FE0, 0xF8C0, 0x3FE0, 0x03FF, 0x001F, 0x0000, 0xFFFF, 0xFFFF, 0x03C0, 0x0E70, 0x3C3C, 0xF00F, 0xC003, 0x0000, 0x3E0C, 0x7F0E, 0xE387, 0xC183, 0xE1C7, 0x70FE, 0x307C], // The PEAKS
        [0x0000, 0x4000, 0x4004, 0x7FFC, 0x4104, 0x4100, 0x4100, 0x4100, 0x4100, 0x22C0, 0x2234, 0x1C0C, 0x0004, 0x0000, 0x0000, 0x0800, 0x1002, 0x7FFE, 0x0002, 0x0000, 0x0000, 0x1802, 0x200E, 0x4012, 0x4022, 0x4042, 0x4082, 0x4102, 0x2202, 0x1C02, 0x0000, 0x0000, 0x0200, 0x0208, 0x0210, 0x22E1, 0x2202, 0x220C, 0x23F0, 0xFE00, 0x2201, 0x23FF, 0x2200, 0x2280, 0x0260, 0x0218, 0x0200, 0x0000, 0x0810, 0x0810, 0xFFE1, 0x0822, 0x084C, 0x1FF0, 0x1204, 0x1204, 0x13FA, 0x1004, 0xFF18, 0x10F0, 0x90CC, 0x7702, 0x100F, 0x0000], // R12赤城
        [0x2002, 0x3FFE, 0x2082, 0x2080, 0x2080, 0x2080, 0x1170, 0x0E0E, 0x0002, 0x0400, 0x0802, 0x3FFE, 0x0002, 0x0000, 0x0C02, 0x1006, 0x200A, 0x2012, 0x2022, 0x1042, 0x0F82, 0x0002, 0x001E, 0x00E2, 0x0340, 0x0C40, 0x3040, 0x0C40, 0x0340, 0x00E2, 0x001E, 0x0002, 0x2002, 0x3FFE, 0x2182, 0x0240, 0x0420, 0x0810, 0x3008, 0x2006, 0x0002, 0x001E, 0x00E2, 0x0340, 0x0C40, 0x3040, 0x0C40, 0x0340, 0x00E2, 0x001E, 0x0002, 0x07F0, 0x0808, 0x1004, 0x2002, 0x2002, 0x2002, 0x1044, 0x1048, 0x3C7E, 0x0040, 0x2002, 0x3FFE, 0x2002], // R12AKAGI
        [0x0000, 0x0800, 0x1002, 0x7FFE, 0x0002, 0x0000, 0x180E, 0x2012, 0x4022, 0x4042, 0x4082, 0x2102, 0x1E02, 0x0000, 0x1000, 0x6000, 0x4000, 0x4002, 0x7FFE, 0x4002, 0x4000, 0x6000, 0x1000, 0x0000, 0x4002, 0x7FFE, 0x0202, 0x0200, 0x0202, 0x01FE, 0x0002, 0x0000, 0x0200, 0x0208, 0x0210, 0x22E1, 0x2202, 0x220C, 0x23F0, 0xFE00, 0x2201, 0x23FF, 0x2200, 0x2280, 0x0260, 0x0218, 0x0200, 0x0000, 0x0810, 0x0810, 0xFFE1, 0x0822, 0x084C, 0x1FF0, 0x1204, 0x1204, 0x13FA, 0x1004, 0xFF18, 0x10F0, 0x90CC, 0x7702, 0x100F, 0x0000]  //　12Th赤城
    ];
    /**
     * @param c RGB color
     */
    //% blockId="setColor" block="set Color RGB%c"
    export function setColor(c: number): void {
        color = c;
    }
    /**
     */
    //% blockId="show" block="show"
    export function show(): void {
        strip.show();
    }
    /**
     * @param b brightness
     */
    //% blockId="setBrightness" block="set Brightness brightness%b"
    export function setBrightness(b: number): void {
        strip.setBrightness(b)
    }
    /**
     * @param p position
     * @param n number
     * @param f font
     */
    //% blockId="displayNumber" block="number pos%p num%n font%f"
    export function displayNumber(p: number, n: number, f: number): void {
        let font: number[];
        if (f == 8) font = font8[n];
        else if(f == 9) font = font9[n];
        else if (f == 10) font = font10[n];
        else if (f == 12) font = font12[n];
        else font = font64[n];

        let fp = 0;
        for (let c = p; c < (p + f); c++) {
            for (let j = 0; j < 16; j++) {
                if ((c % 2) == 0) {
                    if (((font[fp] >> (15 -j)) & 0x01) == 0x01) {
                        strip.setPixelColor(c * 16 + j, color);
                    } else {
                        strip.setPixelColor(c * 16 + j, NeoPixelColors.Black);
                    }
                } else {
                    if (((font[fp] >> (15 - j)) & 0x01) == 0x01) {
                        strip.setPixelColor(c * 16 + (15 - j), color);
                    } else {
                        strip.setPixelColor(c * 16 + (15 - j), NeoPixelColors.Black);
                    }
                }
            }
            fp++;
        }
    }
    /**
     * @param p position
     */
    //% blockId="displayColon" block="colon pos%p"
    export function displayColon(p: number): void {
        strip.setPixelColor(p * 16 + 3, color);
        strip.setPixelColor(p * 16 + 4, color);
        strip.setPixelColor(p * 16 + 5, color);
        strip.setPixelColor(p * 16 + 10, color);
        strip.setPixelColor(p * 16 + 11, color);
        strip.setPixelColor(p * 16 + 12, color);
        strip.setPixelColor(p * 16 + 19, color);
        strip.setPixelColor(p * 16 + 20, color);
        strip.setPixelColor(p * 16 + 21, color);
        strip.setPixelColor(p * 16 + 26, color);
        strip.setPixelColor(p * 16 + 27, color);
        strip.setPixelColor(p * 16 + 28, color);
    }
    /**
     * @param p position
     * @param c number
     */
    //% blockId="clearColumn" block="clear pos%p col%c"
    export function clearColumn(p: number, c: number): void {
        for (let i = 0; i < c; i++) {
            for (let j = 0; j < 16; j++) {
                strip.setPixelColor((i * 16) + j, NeoPixelColors.Black)
            }
        }
    }
    /**
     * @param h hour
     * @param m minute
     * @param s second
     */
    //% blockId="showClock" block="clock hour%h minute%m second%s"
    export function showClock(h: number, m: number, s: number): void {
        clearColumn(0, 64);

        if (Math.trunc(h / 10) != 0) {
            displayNumber(0, Math.trunc(h / 10), 8);
        }
        displayNumber(9, h % 10, 9);
        displayColon(19);
        displayNumber(22, Math.trunc(m / 10), 9);
        displayNumber(32, m % 10, 9);
        displayColon(42);
        displayNumber(45, Math.trunc(s / 10), 9);
        displayNumber(55, s % 10, 9);

        strip.show();
    }
}
